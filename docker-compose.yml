version: '3.8'

services:
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: dn42-bot-server
    volumes:
      # Mount your config.py file here (create it first based on config.example.py)
      - ./server/config.py:/app/config.py:ro
      # Persistent data
      - server-data:/app/data
    ports:
      - "3443:3443"
    restart: unless-stopped
    networks:
      - dn42-bot-network

  agent:
    build:
      context: ./agent
      dockerfile: Dockerfile
    container_name: dn42-bot-agent
    cap_add:
      - NET_ADMIN
      - NET_RAW
    devices:
      - /dev/net/tun
    volumes:
      # Mount your agent_config.json file here (create it first based on agent_config.example.json)
      - ./agent/agent_config.json:/app/agent_config.json:ro
      # Mount WireGuard config directory if needed
      - /etc/wireguard:/etc/wireguard:ro
      # Optional: Mount tcping binary
      # - /usr/local/bin/tcping:/usr/local/bin/tcping:ro
    ports:
      - "54321:54321"
    restart: unless-stopped
    networks:
      - dn42-bot-network

volumes:
  server-data:

networks:
  dn42-bot-network:
    driver: bridge
